<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Iterate.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Motif</a> &gt; <a href="index.source.html" class="el_package">no.motif</a> &gt; <span class="el_source">Iterate.java</span></div><h1>Iterate.java</h1><pre class="source lang-java linenums">package no.motif;

import static java.util.Arrays.asList;
import static java.util.Collections.emptyList;
import static no.motif.Singular.optional;

import java.util.Comparator;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;

import no.motif.f.Fn;
import no.motif.f.Predicate;
import no.motif.iter.PreIndexedContentIterator;
import no.motif.iter.PreparedIterable;
import no.motif.iter.boxing.BytesIterable;
import no.motif.iter.ordering.ByPropertyComparator;
import no.motif.iter.ordering.EnhancedComparator;
import no.motif.iter.ordering.EnhancedComparatorImpl;
import no.motif.types.Elements;


/**
 * Operations for containers, e.g. arrays,
 * {@link List lists}, {@link Set sets}, or any implementation
 * of {@link Iterable}. Can also
 * {@link #on(CharSequence) treat Strings as a container of Characters}.
 *
 */
public final class Iterate {

<span class="fc" id="L33">    private static final Elements&lt;?&gt; NONE = new PreparedIterable&lt;&gt;(emptyList());</span>

    /**
     * @return An empty &lt;code&gt;Elements&lt;/code&gt; container.
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; Elements&lt;T&gt; none() {
<span class="fc" id="L40">        return (Elements&lt;T&gt;) NONE;</span>
    }


    /**
     * Manipulate CharSequences/Strings as if they were iterables of
     * Characters.
     *
     * @param string The string
     * @return {@link Elements} characters
     */
    public static Elements&lt;Character&gt; on(final CharSequence string) {
<span class="fc bfc" id="L52" title="All 2 branches covered.">        if (string == null) return Iterate.none();</span>
<span class="fc" id="L53">        Iterable&lt;Character&gt; chars = new Iterable&lt;Character&gt;() {</span>
            @Override public Iterator&lt;Character&gt; iterator() {
<span class="fc" id="L55">                return new PreIndexedContentIterator&lt;Character&gt;(string.length()) {</span>
                    @Override protected Character elementAt(int index) {
<span class="fc" id="L57">                        return string.charAt(index);</span>
                    }
                };
            }
        };
<span class="fc" id="L62">        return newInstance(chars);</span>
    }


    /**
     * Work with multiple elements.
     *
     * @param elements the elements to manipulate as vararg/array.
     * @return {@link Elements}
     */
    @SafeVarargs
    @SuppressWarnings(&quot;varargs&quot;)
    public static &lt;T&gt; Elements&lt;T&gt; on(T ... elements) {
<span class="fc bfc" id="L75" title="All 2 branches covered.">        return newInstance(elements != null ? asList(elements) : null);</span>
    }

    /**
     * Work with multiple bytes.
     *
     * @param bytes the bytes to manipulate as vararg/array.
     */
    public static Elements&lt;Byte&gt; on(byte[] bytes) {
<span class="fc bfc" id="L84" title="All 2 branches covered.">        return newInstance(bytes != null ? new BytesIterable(bytes) : null);</span>
    }



    public static &lt;K, V&gt; Elements&lt;Map.Entry&lt;K, V&gt;&gt; on(Map&lt;K, V&gt; map) {
<span class="fc bfc" id="L90" title="All 2 branches covered.">        return on(map != null ? map.entrySet() : null);</span>
    }


    /**
     * Work with multiple elements.
     *
     * @param elements the elements to manipulate as an {@link Iterable}.
     * @return {@link Elements}
     */
    public static &lt;T&gt; Elements&lt;T&gt; on(Iterable&lt;T&gt; elements) {
<span class="fc bfc" id="L101" title="All 2 branches covered.">        return elements instanceof Elements ? (Elements&lt;T&gt;) elements : newInstance(elements);</span>
    }






    private static &lt;T&gt; Elements&lt;T&gt; newInstance(Iterable&lt;T&gt; elements) {
<span class="fc bfc" id="L110" title="All 4 branches covered.">        if (elements == null || !elements.iterator().hasNext()) return none();</span>
<span class="fc" id="L111">        else return new PreparedIterable&lt;T&gt;(elements);</span>
    }



    /**
     * Create a {@link java.util.Comparator} from an {@link Fn}, typically to
     * sort using a {@link Comparable} property of a type.
     *
     * @param property the {@link Fn} which obtains the comparable property
     *
     * @return a {@link Comparator} using the value yielded from the given {@link Fn}.
     */
    public static &lt;T, P extends Comparable&lt;P&gt;&gt; EnhancedComparator&lt;T&gt; by(final Fn&lt;T, P&gt; property) {
<span class="fc" id="L125">        return new EnhancedComparatorImpl&lt;&gt;(new ByPropertyComparator&lt;&gt;(property));</span>
    }


    /**
     * Convert a type with natural ordering, i.e. implements {@link Comparable}, to
     * an external {@link Comparator}. This is a little quirk to provide a typesafe
     * way to sort iterables containing &lt;code&gt;Comparables&lt;/code&gt;, instead of risking
     * a runtime ClassCastException. Pass this to the
     * {@link no.motif.iter.CollectingIterable#sorted(Comparator) .sorted(..)}
     * method to get elements as a sorted list.
     *
     * @param comparableType The {@link Comparable} type to create a {@link Comparator} from.
     * @return the &lt;code&gt;Comparator&lt;/code&gt;
     */
    public static &lt;T extends Comparable&lt;T&gt;&gt; EnhancedComparator&lt;T&gt; byOrderingOf(Class&lt;T&gt; comparableType) {
<span class="fc" id="L141">        return by(NOP.&lt;T&gt;fn()); }</span>


    /**
     * Evaluates if an {@link Iterable} is empty.
     */
<span class="fc" id="L147">    public static final Predicate&lt;Iterable&lt;?&gt;&gt; empty = new Predicate&lt;Iterable&lt;?&gt;&gt;() {</span>
<span class="fc" id="L148">        @Override public boolean $(Iterable&lt;?&gt; iterable) { return on(iterable).isEmpty(); }};</span>


    /**
     * The {@link Iterator#hasNext()} method as a function.
     */
<span class="fc" id="L154">    public static final Predicate&lt;Iterator&lt;?&gt;&gt; hasNext = new Predicate&lt;Iterator&lt;?&gt;&gt;() {</span>
<span class="fc" id="L155">        @Override public boolean $(Iterator&lt;?&gt; iterator) { return iterator.hasNext(); }};</span>


    /**
     * @return The {@link Iterator#next()} as a function.
     */
<span class="fc" id="L161">    public static final &lt;T&gt; Fn&lt;Iterator&lt;T&gt;, T&gt; next() { return new Fn&lt;Iterator&lt;T&gt;, T&gt;() {</span>
<span class="fc" id="L162">        @Override public T $(Iterator&lt;T&gt; iterator) { return iterator.next(); }};};</span>



    /**
     * Using a function which takes an object and returns another object of the same type,
     * recursively call this function until it yields &lt;code&gt;null&lt;/code&gt;, and ultimately yield the
     * last object.
     *
     * @param next The function which takes an object and yields another object of the same type.
     *             This is typically used for objects implementing a linked list-like structure,
     *             where each object refers to the next in a chain.
     *
     * @return A function which will descend the chain and yield the last object. If the given
     *         &lt;code&gt;next&lt;/code&gt; {@link Fn} never returns &lt;code&gt;null&lt;/code&gt;, calling this
     *         returned function will result in an infinite recursion.
     */
    public static &lt;T&gt; Fn&lt;T, T&gt; last(final Fn&lt;? super T, ? extends T&gt; next) {
<span class="fc" id="L180">        return new Fn&lt;T, T&gt;() {</span>
        @Override public T $(T value) {
<span class="fc" id="L182">            return optional(next.$(value)).map(this).orElse(value);</span>
        }};
    }


    /**
     * A bridge from functions yielding arrays, to functions yielding iterables.
     *
     * @param yieldsArray the array-yielding function.
     * @return an adapted function yielding an iterable of the array yielded from the original function.
     */
    public static &lt;I, O&gt; Fn&lt;I, Iterable&lt;O&gt;&gt; toIterable(final Fn&lt;I, O[]&gt; yieldsArray) {
<span class="fc" id="L194">        return new Fn&lt;I, Iterable&lt;O&gt;&gt;() { @Override public Iterable&lt;O&gt; $(I value) { return on(yieldsArray.$(value)); }}; }</span>



<span class="fc" id="L198">    private Iterate() {}</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.0.201403182114</span></div></body></html>